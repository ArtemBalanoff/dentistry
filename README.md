# Управление Стоматологическими Услугами

## Описание проекта
Данное приложение — это система для управления стоматологическими услугами. Пользователи могут записываться на прием, просматривать услуги, докторов, их доступность по многим факторам, и управлять своей учетной записью.

## Основные возможности:

- **Управление профилями пользователей** (пациенты, доктора)
- **Управление расписанием** работы клиники и докторов
- **Поддержка создания и редактирования исключений** из расписания
- **Запись на прием** к врачу на основе доступных временных слотов и многоуровневого расписания
- **Аутентификация и авторизация** с использованием JWT-токенов
- **Просмотр доступных услуг** и их опций
- **Управление специализациями врачей**

## Роли и права пользователей:

- **Аноним:** может только просматривать информацию о клинике, услугах, врачах и их доступности.
- **Пациент:** может управлять своим профилем, просматривать доступные услуги, докторов, их расписание и специализацию, может получать актуальные данные по возможности записи на конкретную дату или в промежутке от настоящего дня. Имеет доступ к своим записям.
- **Доктор:** может записывать клиентов на прием к себе или другим врачам, имеет возможность закрывать свои приемы (то есть, конкретизировать опцию и цену каждой оказанной услуги). Имеет доступ ко всем записям в клинике.
- **Администратор:** управляет всеми моделями приложения и имеет полный доступ

## Технологии:

- **Python**
- **Django REST Framework**
- **Git**
- **GitHub**
- **GitHubActions**
- **PostgreSQL**
- **Docker**
- **SimpleJWT**
- **Djoser**
- **Flake8**

## Как запустить проект:

1. **Клонировать репозиторий и перейти в него в командной строке:**
    ```bash
    git clone git@github.com:ArtemBalanoff/dentistry.git
    cd dentistry-project
    ```

2. **Создать и активировать виртуальное окружение:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```

3. **Установить зависимости из файла `requirements.txt`:**
    ```bash
    python3 -m pip install --upgrade pip
    pip install -r requirements.txt
    ```

4. **Выполнить миграции:**
    ```bash
    python3 manage.py migrate
    ```

5. **Запустить проект:**
    ```bash
    python3 manage.py runserver
    ```

## Как запустить Postman тесты:

( По умолчанию запросы будут отправляться на удаленный сервер, но в variables можно переключить переменную `host` для тестирования на локальном сервере )

1. **Подготовить БД к тестированию:**
    ```bash
    bash scripts/set_up_data.sh
    ```

2. **Перейти в директорию `postman_collection`**

3. **Импортировать файл `Dentistry Collection.postman_collection.json` в Postman**

4. **Выбрать `Dentistry Collection` и нажать `Run collection`**

( Для повторного тестирования нужно повторить первый пункт )

## Доступные эндпоинты:

### Запись на прием:

- **GET** - Получение списка всех записей из бд
    ```
    api/v1/appointments/
    ```

- **POST** - Создание новой записи на прием (Доктор может выбрать пациента, а пациент автоматически всегда выбирает себя)
    ```
    api/v1/appointments/
    ```

- **GET** - Получение информации о записи на прием по ID
    ```
    api/v1/appointments/<pk>/
    ```

- **PATCH** - Частичное обновление записи на прием по ID
    ```
    api/v1/appointments/<pk>/
    ```

- **POST** - Закрытие записи (только врач закрывает запись после проведения приема, уточняя опции и цену приема)
    ```
    api/v1/appointments/<pk>/close/
    ```

### Работа с расписанием:

- **GET** - Получение расписания клиники
    ```
    api/v1/clinic-schedule/
    ```

- **GET** - Получение расписания врача
    ```
    api/v1/doctors-schedule/
    ```

- **GET** - Получение списка свободных дней для записи
    ```
    api/v1/get-available-days?period={day_count}&services=[{service_id}]&doctors=[{doctor_id}]
    required: services
    ```

- **GET** - Получение списка временных слотов для конкретной даты и доктора
    ```
    api/v1/get-available-timeslots?date={date}&services=[{service_id}]&doctor={doctor_id}
    required: services, doctor
    ```

### Пользователи и аутентификация:

- **POST** - Создание JWT-токена
    ```
    api/v1/auth/jwt/create/
    ```

- **POST** - Обновление JWT-токена
    ```
    api/v1/auth/jwt/refresh/
    ```

- **POST** - Верификация JWT-токена
    ```
    api/v1/auth/jwt/verify/
    ```

- **GET** - Получение данных своей учетной записи
    ```
    api/v1/auth/users/me/
    ```

## Проект на удаленном сервере:

- https://dentistry.servebeer.com/
- https://dentistry.servebeer.com/admin/
- `login:` +79786666666
- `password:` password
